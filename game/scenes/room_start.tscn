[gd_scene load_steps=8 format=3]

[ext_resource type="Script" path="res://scripts/room_base.gd" id="1"]
[ext_resource type="PackedScene" path="res://scenes/pickup_health.tscn" id="2"]
[ext_resource type="PackedScene" path="res://scenes/pickup_key.tscn" id="3"]
[ext_resource type="PackedScene" path="res://scenes/pickup_sword.tscn" id="4"]
[ext_resource type="PackedScene" path="res://scenes/enemy_bat.tscn" id="5"]

[sub_resource type="GDScript" id="GDScript_slime"]
script/source = "extends CharacterBody2D

@export var hop_force: float = 80.0
@export var hop_interval: float = 1.8
@export var detection_range: float = 200.0

var _player: Node2D = null
var _hop_timer: float = 0.0

func _ready() -> void:
	add_to_group(\"enemies\")

func _physics_process(delta: float) -> void:
	if not _player:
		_player = get_tree().get_first_node_in_group(\"player\")
		if not _player:
			return
	
	var distance := global_position.distance_to(_player.global_position)
	if distance > detection_range:
		return
	
	_hop_timer += delta
	if _hop_timer >= hop_interval:
		_hop_timer = 0.0
		var dir := global_position.direction_to(_player.global_position)
		velocity = dir * hop_force
	
	move_and_slide()
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_slime"]
size = Vector2(16, 12)

[node name="RoomStart" type="Node2D"]
script = ExtResource("1")
room_id = "room_start"

[node name="Walls" type="Node2D" parent="."]

[node name="WallTop" type="StaticBody2D" parent="Walls"]
position = Vector2(320, 40)
collision_layer = 1

[node name="ColorRect" type="ColorRect" parent="Walls/WallTop"]
offset_left = -320.0
offset_top = -40.0
offset_right = 320.0
color = Color(0.3, 0.3, 0.35, 1)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallTop"]
position = Vector2(0, -20)
shape = SubResource("RectangleShape2D_slime")
scale = Vector2(40, 1)

[node name="WallBottom" type="StaticBody2D" parent="Walls"]
position = Vector2(320, 440)
collision_layer = 1

[node name="ColorRect" type="ColorRect" parent="Walls/WallBottom"]
offset_left = -320.0
offset_top = 0.0
offset_right = 320.0
offset_bottom = 40.0
color = Color(0.3, 0.3, 0.35, 1)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallBottom"]
position = Vector2(0, 20)
shape = SubResource("RectangleShape2D_slime")
scale = Vector2(40, 1)

[node name="WallLeft" type="StaticBody2D" parent="Walls"]
position = Vector2(40, 240)
collision_layer = 1

[node name="ColorRect" type="ColorRect" parent="Walls/WallLeft"]
offset_left = -40.0
offset_top = -200.0
offset_right = 0.0
offset_bottom = 200.0
color = Color(0.3, 0.3, 0.35, 1)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallLeft"]
position = Vector2(-20, 0)
shape = SubResource("RectangleShape2D_slime")
scale = Vector2(1, 25)

[node name="WallRight" type="StaticBody2D" parent="Walls"]
position = Vector2(600, 240)
collision_layer = 1

[node name="ColorRect" type="ColorRect" parent="Walls/WallRight"]
offset_left = 0.0
offset_top = -200.0
offset_right = 40.0
offset_bottom = 200.0
color = Color(0.3, 0.3, 0.35, 1)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallRight"]
position = Vector2(20, 0)
shape = SubResource("RectangleShape2D_slime")
scale = Vector2(1, 25)

[node name="Doors" type="Node2D" parent="."]

[node name="Pickups" type="Node2D" parent="."]

[node name="PickupHealth" parent="Pickups" instance=ExtResource("2")]
position = Vector2(200, 300)

[node name="PickupKey" parent="Pickups" instance=ExtResource("3")]
position = Vector2(320, 300)

[node name="PickupSword" parent="Pickups" instance=ExtResource("4")]
position = Vector2(260, 300)

[node name="Enemies" type="Node2D" parent="."]

[node name="Slime1" type="CharacterBody2D" parent="Enemies"]
position = Vector2(150, 150)
collision_layer = 2
collision_mask = 1
script = SubResource("GDScript_slime")
hop_interval = 1.8

[node name="Sprite" type="ColorRect" parent="Enemies/Slime1"]
offset_left = -8.0
offset_top = -6.0
offset_right = 8.0
offset_bottom = 6.0
color = Color(0.2, 0.8, 0.1, 1)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Enemies/Slime1"]
shape = SubResource("RectangleShape2D_slime")

[node name="HealthComponent" type="Node" parent="Enemies/Slime1"]
script = ExtResource("2")
max_health = 20

[node name="Slime2" type="CharacterBody2D" parent="Enemies"]
position = Vector2(490, 150)
collision_layer = 2
collision_mask = 1
script = SubResource("GDScript_slime")
hop_interval = 2.1

[node name="Sprite" type="ColorRect" parent="Enemies/Slime2"]
offset_left = -8.0
offset_top = -6.0
offset_right = 8.0
offset_bottom = 6.0
color = Color(0.2, 0.8, 0.1, 1)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Enemies/Slime2"]
shape = SubResource("RectangleShape2D_slime")

[node name="HealthComponent" type="Node" parent="Enemies/Slime2"]
script = ExtResource("2")
max_health = 20

[node name="Bat1" parent="Enemies" instance=ExtResource("5")]
position = Vector2(320, 100)

[node name="Bat2" parent="Enemies" instance=ExtResource("5")]
position = Vector2(450, 180)
swoop_cooldown = 3.0