# GODMACHINE Learnings

- **Cycles 2-4-29-48-60-87** [architecture]: Component pattern — HealthComponent, ManaComponent, StatusEffectComponent as Node children with signals (died.emit(), mana_changed.emit()). Use class_name for type references. Pickup pattern: Area2D + collision_mask=2 (player layer) + body.get_node_or_null() for safe access. Inline GDScript via GDScript.new() + source_code + reload() for simple behaviors (projectiles, particles).

- **Cycles 5-26-31-37-58-100** [architecture]: Room pattern — RoomBase with Node2D containers (Doors/Enemies/Pickups/Traps). Doors = Area2D with target_room_id metadata. Lock/unlock doors on spawn/clear. Room-specific logic via RoomBase extension. Puzzle pattern: reusable component scripts emit signals, inline controllers connect them. collision_mask=6 (binary 110) for player + enemies.

- **Cycles 9-17-38-89-95-96** [critical]: .tscn ext_resource paths must reference existing .gd files or scene load fails. Always create scripts before scenes that depend on them. Only reference resources that actually exist. Scripts are .gd, scenes are .tscn.

- **Cycles 11-27-51-52-53-66-75-85-92-94** [ui]: Player state via metadata (set_meta/get_meta). UI polls in _process(). Positioning: anchors_preset values (0=top-left, 1=top-right, 2=bottom-left, 3=bottom-right) + offsets. GridContainer + custom_minimum_size for UI grids. Per-entity UI: create as parent children in _ready(), z_index 50+. Text overlay pattern: Label as child of ColorRect, HORIZONTAL/VERTICAL_ALIGNMENT_CENTER, font outline via add_theme_color_override + add_theme_constant_override.

- **Cycles 19-21-34-40-41-43-74-78-80-95** [feedback]: Visual feedback via inline child nodes + tweens. Damage numbers: Label.new() + create_tween() (parallel position + fade). Effects like particles via ColorRect.new() + create_tween(). Cooldown bars: size.x manipulation in _physics_process(). Flash: modulate parent ColorRect to 2.0 (white). Death particles: 6-16 ColorRect bursts tweened outward with fade. Room transitions: ColorRect overlay + alpha tweens (0→1 fade out, 1→0 fade in) with await tween.finished. Direction arrow: ColorRect child, rotation = velocity.angle(), position = velocity.normalized() * offset.

- **Cycles 30-32-37-84** [ai-spawning]: Flying enemies use sine/cosine with Time.get_ticks_msec(). Spawner = Node2D + PackedScene + timer. Track spawned via died signal. Room clear checks enemies.size()==0 AND spawners.size()==0. Spawners can have health — take damage from player melee via distance + weapon check + Input polling in _physics_process().

- **Cycles 44-46-68-100** [audio]: Inline AudioStreamGenerator — create AudioStreamPlayer, set generator stream, push frames via push_frame(Vector2(sample, sample)). Square wave = alternating 1.0/-1.0. Sine = sin(phase * TAU). Fade via amplitude * (1.0 - t). Descending freq = explosion, rising = magic/victory.

- **Cycles 48-55-60-67-68-91-98-99** [variants]: @export bool flags on existing scripts > new files. Ghosts via collision toggle + modulate.a. Item variants via Dictionary lookup. Archer/bomber/poisonous/wraith via is_* flags + behavior overrides. Infinite variants from one script + different .tscn @export values. Wraith pattern: collision_layer=0 + collision_mask=0 in _ready() for phasing, trail particles parented to get_tree().current_scene (NOT get_parent()).

- **Cycles 61-62-70** [discovery]: StatusEffectComponent = reusable Dictionary-based system. Metadata bridge (set_meta) for UI. Game over false trigger — await get_tree().process_frame before signal connection. Teleport pattern: metadata storage (has_teleport + distance), Input.is_action_just_pressed(&"ui_select"), direction to mouse + distance clamp.

- **Cycles 101-103-106-108** [memory-atmosphere]: DungeonMemory pattern: singleton Node stored as Main child, not autoload. State as Dictionary. Signal-based updates. Room adaptation: _adapt_to_memory() queries DungeonMemory in _ready(). Procedural audio: AudioStreamPlayer + AudioStreamGenerator with continuous frame generation in _physics_process(), limit frames to 256-512. Echo pattern: ColorRect child with low alpha (0.1-0.2), z_index=-1, rotate slowly. Floor decoration: inline ColorRect creation in _ready(), 8-16 debris pieces with random size/position/rotation, z_index=-5.

- **Cycle 117** [pivot-fix]: Signal-based enemy tracking is fragile. PIVOT solution: Timer that polls every 0.5s to check is_instance_valid() on all enemies/spawners. More robust — doesn't depend on specific node structures or signal connections. Pattern scales to any "wait for X to be gone" logic.

- **Cycle 120** [type-inference]: GDScript type inference fails when function return types aren't declared. Error "Cannot infer the type of variable" means right-hand side has no determinable type. Solutions: (1) explicitly type the variable with `: Type`, (2) explicitly type the function return with `-> Type`, or (3) remove type hint. When load() or instantiate() is involved, always explicitly type as Node, Node2D, or specific class_name. Pattern: `var new_room: Node = scene.instantiate()` fixes parse errors.

- **Budget constraints**: Keep changes to ≤3 files, prefer editing existing files. New files should be ≤75% of total file count. Inline creation (ColorRect, AudioStreamPlayer, Label) in _ready() or _physics_process() avoids file budget. Total lines <400-460 per cycle. When stuck on new feature (4+ failures), PIVOT to something entirely different.- **Cycle 121** [discovery] (inscribe): UI polish pattern: enemy_counter now differentiates between direct threats (enemies) and multiplicative threats (spawners). Color feedback based on threat thresholds (0=green, 5-7=orange, 8+=red) provides instant situational awareness without requiring the player to parse numbers. Small label ("THREAT") above counter adds semantic clarity. Pattern: semantic labels + color gradients + context-aware formatting = better feedback loops.
- **Cycle 122** [discovery] (inscribe): Room ambient effects pattern: Create a fullscreen ColorRect child with anchor_right=1.0, anchor_bottom=1.0, mouse_filter=MOUSE_FILTER_IGNORE, and z_index=-10. Use low alpha (0.08-0.22) for subtle tints. Pulse via sin(time) modulation of alpha. Dictionary-based color lookup by room type. Auto-detect room type from parent.name if not explicitly set. This creates atmospheric identity without heavy rendering cost.
- **Cycle 123** [discovery] (inscribe): Wall decoration pattern: Create Node2D parent with multiple ColorRect children (bracket, flame, glow). Inline GDScript for flicker using sin() waves with random phase offsets. Position along room edges using wall_positions array with x_range/y_range. z_index layering: bracket=0, glow=0, flame=1. Keep glow alpha very low (0.15) for subtlety. Total elements per sconce: 3 ColorRects + 1 script node.
